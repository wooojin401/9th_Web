# useEffect 훅 정리

## 실행조건

**useEffect**를 사용하면 **특정한 조건에서만 Side Effect가 실행되도록 제어**할 수 있습니다.

1. **처음 마운트될 때만 실행**

   - API를 딱 한 번만 호출하고 싶을 때 사용합니다.

2. **특정 값이 변경될 때 실행**

   - 예: `searchKeyword` 값이 바뀔 때마다 API를 호출합니다.

3. **컴포넌트가 리렌더링될 때마다 실행**
   - 별도의 제약 없이 매번 실행됩니다.

## 의존성 배열(Dependency Array)

```tsx
import { useEffect } from "react";

useEffect(() => {
  // 실행할 부수 효과 코드 (예: API 호출, 이벤트 등록 등)
}, []);
```

- **첫 번째 인자 (Callback Function)**

  - 실행할 부수 효과 코드를 함수로 작성합니다.
  - 예: 데이터 요청, 이벤트 리스너 등록 등

- **두 번째 인자 (Dependency Array)**
  - 배열에 들어간 값이 변할 때만 실행됩니다.
  - 빈 배열일 경우 ([]) 컴포넌트가 처음 마운트될 때 한 번만 실행됩니다.

---

# 클린업 함수

```tsx
useEffect(() => {
  const mouseClickEffectEvent = () => {
    console.log(counter);
  };

  window.addEventListener("click", mouseClickEffectEvent);

  // 클린업 함수
  return () => {
    console.log("클린업 함수 실행!", counter);
    window.removeEventListener("click", mouseClickEffectEvent);
  };
}, [counter]);
```

## 클린업 함수가 필요한 이유

- 이벤트 핸들러가 반복해서 등록되면, 같은 이벤트가 중복 실행되거나 메모리 누수가 발생할 수 있습니다.
- 클린업 함수는 **이전 이벤트를 제거하고 새로운 이벤트만 유지**하는 역할을 합니다.
- 이를 통해 이벤트 중복 실행 문제를 예방할 수 있습니다.

## 언마운트 vs 클린업 함수

- **클래스 컴포넌트의 componentWillUnmount**

  - 컴포넌트가 **DOM에서 완전히 사라질 때** 한 번만 실행됩니다.

- **함수 컴포넌트의 클린업 함수**
  - 컴포넌트가 언마운트될 때도 실행되지만, **리렌더링될 때마다 이전 사이드 이펙트를 정리**합니다.
  - 매번 이전 상태를 정리하고 새로운 사이드 이펙트를 실행하는 구조입니다.

## 핵심 정리

1. **처음 마운트** → useEffect 실행, 이벤트 등록
2. **리렌더링 발생** → 이전 클린업 함수 실행 → 새로운 사이드 이펙트 실행
3. **언마운트 시점** → 마지막 클린업 함수 실행

- 덕분에 메모리 누수, 중복 이벤트 등록 등의 문제를 예방할 수 있습니다.

---

# useEffect 최종 정리

## 1. 기본 개념

- `useEffect`는 **컴포넌트가 렌더링된 이후에 실행**됩니다.
- 항상 최신 상태값을 참조할 수 있습니다.
- 실행 과정에서 이전 `useEffect`는 **destroy** 되고, 새로운 `useEffect`가 만들어집니다.

## 2. 상태 변화 시 주의

- 상태를 변경하거나 **타이머/구독/이벤트** 등을 설정할 때는 **클린업 함수**를 사용해야 합니다.
- 그렇지 않으면 **중복 실행**이나 **메모리 누수**가 발생할 수 있습니다.

## 3. 클린업 함수 적용

- 컴포넌트가 **언마운트** 되거나 `useEffect`가 다시 실행될 때 클린업 함수가 실행됩니다.
- 클린업 함수는 **불필요한 중복 실행**을 방지합니다.
- 덕분에 메모리 누수와 이벤트/타이머 중복 실행 문제를 예방할 수 있습니다.

## 4. 결론

- **useEffect는 렌더 후 실행**되므로 항상 최신값을 가져옵니다.
- 상태, 타이머, 구독 등 **사이드 이펙트 설정 시 클린업 함수 사용**이 필요합니다.
- 클린업을 통해 **메모리 누수와 중복 실행을 방지**할 수 있습니다.

---
